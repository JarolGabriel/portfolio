---
import Container from './Container.astro';
import Button from './Button.astro';
import { ChevronLeft, ChevronRight } from 'lucide-astro';
import { getLangFromUrl, useTranslations } from '../i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const services = [
  {
    number: t('services.item1.number'),
    title: t('services.item1.title'),
    description: t('services.item1.description'),
  },
  {
    number: t('services.item2.number'),
    title: t('services.item2.title'),
    description: t('services.item2.description'),
  },
  {
    number: t('services.item3.number'),
    title: t('services.item3.title'),
    description: t('services.item3.description'),
  },
  {
    number: t('services.item4.number'),
    title: t('services.item4.title'),
    description: t('services.item4.description'),
  },
];
---

<section id="service" class="relative py-16 md:py-24">
  <!-- waves -->
  <div class="absolute inset-0 opacity-10 dark:opacity-20 pointer-events-none">
    <img 
      src="/assets/icons/bg-waves.svg" 
      alt="" 
      class="w-full h-full object-cover object-center"
    />
  </div>

  <Container>
    <!-- Desktop Layout -->
    <div class="hidden md:grid md:grid-cols-[1fr_2fr] md:gap-12 items-start">
      
      <!-- Left Column: Title + Description + Button -->
      <div class="flex flex-col gap-6">
        <h2 class="text-accent text-lg font-menu">
          {t('services.title')}
        </h2>
        <p class="text-heading text-base leading-relaxed font-light max-w-sm">
          {t('services.description')}
        </p>
        <div>
          <Button 
            variant="primary" 
            text={t('hero.cta')} 
            icon="mail"
            href="#contact"
            showArrow={true}
          />
        </div>
      </div>

      <!-- Right Column: 2x2 Grid of Cards -->
      <div class="grid grid-cols-2 gap-4">
        {services.map((service) => (
          <div class="service-card">
            <div class="mb-3">
              <span class="service-number">{service.number}</span>
              <h3 class="service-title">{service.title}</h3>
            </div>
            <p class="service-description mb-4">
              {service.description}
            </p>
            <div class="flex gap-3">
              <Button 
                variant="primary" 
                text={t('services.btn.hire')}
                href="#contact"
                class="flex-1 !text-xs !py-2.5 md:mt-3"
              />
              <Button 
                variant="accent2" 
                text={t('services.btn.details')}
                class="flex-1 !text-xs !py-2.5 md:mt-3"
              />
            </div>
          </div>
        ))}
      </div>
    </div>

    <!-- Mobile Layout -->
    <div class="md:hidden flex flex-col items-center gap-8">
      
      <!-- Title + Description -->
      <div class="text-center">
        <h2 class="text-accent text-lg font-menu mb-4">
          {t('services.title')}
        </h2>
        <p class="text-heading text-base leading-relaxed font-light">
          {t('services.description')}
        </p>
      </div>

      <!-- Button -->
      <div>
        <Button 
          variant="primary" 
          text={t('hero.cta')} 
          icon="mail"
          href="#contact"
        />
      </div>

      <!-- Carousel -->
      <div class="relative w-full max-w-sm">
        <div class="overflow-hidden">
          <div class="carousel-track flex transition-transform duration-300 ease-out" id="carousel-track">
            {services.map((service) => (
              <div class="carousel-slide flex-shrink-0 w-full">
                <div class="service-card-mobile">
                  <div class="mb-4">
                    <span class="service-number-mobile">{service.number}</span>
                    <h3 class="service-title-mobile">{service.title}</h3>
                  </div>
                  <p class="service-description-mobile mb-6">
                    {service.description}
                  </p>
                  <div class="flex gap-3">
                    <Button 
                      variant="primary" 
                      text={t('services.btn.hire')}
                      href="#contact"
                      class="flex-1 !text-[12px] !py-3"
                    />
                    <Button 
                      variant="accent2" 
                      text={t('services.btn.details')}
                      class="flex-1 !text-[12px] !py-3"
                    />
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>

        <!-- Navigation Arrows -->
        <button id="prev-btn" class="carousel-btn carousel-btn-left">
          <ChevronLeft size={24} />
        </button>
        <button id="next-btn" class="carousel-btn carousel-btn-right">
          <ChevronRight size={24} />
        </button>
      </div>

    </div>

  </Container>
</section>

<style>
  /* Desktop Cards */
  .service-card {
    position: relative;
    padding: 1.25rem;
    border-radius: 16px;
    border: 1px solid #F7E97C;
    background-color: var(--color-bg);
    transition: all 0.3s ease;
    height: 100%;
    display: flex;
    flex-direction: column;
  }

  .service-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(247, 233, 124, 0.15);
  }

  .service-number {
    font-family: var(--font-menu);
    font-size: 16px;
    font-weight: 600;
    color: var(--color-accent2);
    margin-right: 0.4rem;
  }

  .service-title {
    display: inline;
    font-family: var(--font-menu);
    font-size: 16px;
    font-weight: 600;
    color: var(--color-accent);
    line-height: 1.3;
  }

  .service-description {
    font-family: var(--font-menu);
    font-size: 12px;
    font-weight: 300;
    color: var(--color-text);
    line-height: 1.4;
    flex-grow: 1;
  }

  /* Mobile Cards */
  .service-card-mobile {
    position: relative;
    padding: 1.75rem;
    border-radius: 20px;
    border: 1px solid #F7E97C;
    background-color: var(--color-bg);
    height: 100%;
    display: flex;
    flex-direction: column;
  }

  .service-number-mobile {
    font-family: var(--font-menu);
    font-size: 18px;
    font-weight: 600;
    color: var(--color-accent2);
    margin-right: 0.5rem;
  }

  .service-title-mobile {
    display: inline;
    font-family: var(--font-menu);
    font-size: 18px;
    font-weight: 600;
    color: var(--color-accent);
    line-height: 1.3;
  }

  .service-description-mobile {
    font-family: var(--font-menu);
    font-size: 14px;
    font-weight: 300;
    color: var(--color-text);
    line-height: 1.5;
    flex-grow: 1;
  }


/* Carousel Buttons */
.carousel-btn {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  width: 30px;
  height: 30px;
  border-radius: 50%;
  border: 2px solid white; 
  background-color: transparent;
  color: white; 
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
  z-index: 10;
}

.carousel-btn-left {
  left: -40px;
}

.carousel-btn-right {
  right: -40px;
}

/* Hover - borde verde */
.carousel-btn:hover:not(:disabled) {
  border-color: var(--color-accent);
  color: var(--color-accent);
}

/* CLICK - verde mientras presionas */
.carousel-btn:active:not(:disabled) {
  border-color: var(--color-accent);
  color: var(--color-accent);
  background-color: transparent;
}

/* Deshabilitado - se queda blanco */
.carousel-btn:disabled {
  opacity: 0.5;
  cursor: default; 
  border-color: white;
  color: white;
}

</style>

<script>
  const track = document.getElementById('carousel-track') as HTMLElement;
  const prevBtn = document.getElementById('prev-btn') as HTMLButtonElement;
  const nextBtn = document.getElementById('next-btn') as HTMLButtonElement;
  
  let currentIndex = 0;
  const totalSlides = 4;

  function updateCarousel() {
    if (track) {
      track.style.transform = `translateX(-${currentIndex * 100}%)`;
    }
    
    // Update prev button
    if (prevBtn) {
      prevBtn.disabled = currentIndex === 0;
      
      // Limpiar estilos inline - dejar que CSS controle
      prevBtn.style.backgroundColor = '';
      prevBtn.style.borderColor = '';
      prevBtn.style.color = '';
    }
    
    // Update next button
    if (nextBtn) {
      nextBtn.disabled = currentIndex === totalSlides - 1;
      
      // Limpiar estilos inline - dejar que CSS controle
      nextBtn.style.backgroundColor = '';
      nextBtn.style.borderColor = '';
      nextBtn.style.color = '';
    }
  }

  prevBtn?.addEventListener('click', () => {
    if (currentIndex > 0) {
      currentIndex--;
      updateCarousel();
    }
  });

  nextBtn?.addEventListener('click', () => {
    if (currentIndex < totalSlides - 1) {
      currentIndex++;
      updateCarousel();
    }
  });

  updateCarousel();
</script>